# Zerocode OpenAPI Generator (POC)

This module (`zerocode-openapi`) is a proof of concept (POC) of a generator of Zerocode scenarios from [OpenAPI](https://swagger.io/docs/specification/v3_0/about/) specifications.

This generator provides a single entry point `generateAll` 
in the `or.jsmart.zerocode.openapi.ScenarioGenerator` class, that takes two arguments:
- File name or url where the OpenAPI specification is located.
- A folder where the generated scenarios will be placed.

The output is a set of scenarios (one for each path in the OpenAPI specification), each containing a step for each operation. Scenario files take the name of the path. Symbols and non ascii characters are replaced by underscore, except brackets (used for path parameters)

## Tests

- Unit Tests: Exercise simple scenarios. Result comparison is made between the generated scenarios (in target) and the expected scenarios (in resources). Html files with the differences are stored in the target folder for offline checking.
- Integration Test: Scenarios generated from the [Swagger Petstore](https://github.com/swagger-api/swagger-petstore) specification, that is the demonstrator of this POC. Result comparison is made as in unit tests using soft assertions. An additional manual performance test was made using the OpenAPI specification of the GitHub API (631 scenarios).
- End to End Tests: Manual tests to verify that the generated scenarios can run against the real Swagger Petstore backend. Test scripts are provided in the E2eTest class.

## Supported features

Currently supported features are enumerated below in the order stated in https://swagger.io/docs/specification/v3_0/about/:

- Media Types: 
  - The schema of the content is the one defined by the `application/json media` type (if present).
  - If not, the first media type found is used, and the corresponding `Content-Type` header is set.
- Operations: Each scenario can generate steps for the `POST` `GET` `PUT` `PATCH` `HEAD` `OPTIONS` `TRACE` and `DELETE` operations defined in the path.
- Parameters and Serialization:
  - Primitive Query Parameters: Added to `request.queryParameters`.
  - Array Query Parameters: Serialized and url encoded in the path. Supports:
    - `form` (default), `spaceDelimited` and `pipeDelimited` formats.
    - `explode` (true by default).
  - Primitive Path Parameters: Serialized and url encoded in the path.
  - Primitive Header Parameters: Added to `request.headers`, `explode` is not supported
- Request Body: As indicated in Media Types.
- Responses: Generates an assertion for the first `2xx` response, if any. Response content is ignored.
- Data Models: Primitive values are generated by Zerocode tokens unless explicitly indicated:
  - Primitive data Types: `string`, `number`, `integer`, `boolean` (randomly generated).
  - Formats: String `date` and `date-time`.
  - Enums: Of primitive data. Values are randomly generated.
  - Arrays and Objects: as defined by their schemas.
  - Maps: The `additionalProperties` keyword generates maps of primitive and non primitive. Free-Form is not supported
- References: `$ref` is handled by the swagger parser.

## Zerocode enhancements

All scenarios generated for the swagger petstore API generate valid requests, but there are a number of possible improvements to enhance the data generation:

- *[Bug] Random strings are not random in a step*. All values generated by the RANDOM.STRING token have the same value inside each step. As workaround, a random number is appended to the random string.
- *Add a token to generate a random value among a set of values*. The ONE.OF token is only supported in asserts. If implemented to generate values in the request body, it would be used to generate enums and booleans without needing random generator at the time of writing the scenarios. Note that this should be able to generate both strings and non strings (quoted and unquoted values, including boolean).
- *Send unquoted numbers in requests*. The value generated for random numbers is a string. This could cause problems problems in the backend to accept these values depending on its serialization approach.
- *Add tokens to generate random date and datetime*. Currently the date/time values generate the current date, that leads to repeated values in a step.
- *Support Zulu timezone designator when generating dates*. Step execution fails if Z is included into the datetime format (it also fails with milliseconds).
- *Add tokens to generate numbers with decimals*. Current workaround concatenates two numbers and dot to include decimals, but this is sent as a string, not as a number
- *Allow ONE.OF to check the response status*. Lowest priority as having more than one 2xx possible responses should be infrequent. Currently the generators adds an assertion for the first success response code that is found. 

		